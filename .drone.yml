workspace:
  base: /srv/drone-demo
  path: .

pipeline:
  test1:
    image: mhart/alpine-node:9.1.0
    group: testing
    # secrets: [ docker_aaa, test_host, test_username, test_password ]
    environment:
      DOCKER_AAA:
        from_secret: docker_aaa
    commands:
      - echo $docker_aaa
      - echo ${docker_aaa}
      - echo ${DOCKER_AAA}
      - echo $DOCKER_AAA

#   deploy-test:
#     image: appleboy/drone-ssh
#     secrets: [ test_host, test_username, test_password ]
#     host: $test_host
#     username: $test_username
#     password: $test_password
#     port: 22
#     script:
#       - echo ${test_host}
#       - echo ${test_username}
#       - echo ${test_password}
#       - ping www.baidu.com
#     environment:
#       TEST_HOST:
#         from_secret: test_host
#       TEST_HOST_USERNAME:
#         from_secret: test_host_username
#       TEST_HOST_PASSWORD:
#         from_secret: test_host_password
#   publish:
#     image: plugins/docker
#     registry: registry.cn-hangzhou.aliyuncs.com
#     repo: registry.cn-hangzhou.aliyuncs.com/tryto/baota
#     tags:
#       - ${DRONE_COMMIT_BRANCH}-${DRONE_COMMIT_SHA:0:8}
#     secrets: [ docker_username, docker_password ]
#     insecure: true
#   deploy-test:
#       image: appleboy/drone-ssh
#       host: [ test_host ]
#       username: [ test_host_username ]
#       password: [ test_host_password ]
#       command_timeout: 2m
#       port: 22
#       script:
#         - sudo docker pull registry.cn-hangzhou.aliyuncs.com/tryto/baota:${DRONE_COMMIT_BRANCH}-${DRONE_COMMIT_SHA:0:8}
#         - docker rm -f docker-demo || true
#         - docker run -d -p 18888:80 --name docker-demo registry.cn-hangzhou.aliyuncs.com/tryto/baota:${DRONE_COMMIT_BRANCH}-${DRONE_COMMIT_SHA:0:8}

